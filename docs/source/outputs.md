# Outputs

Axion-HDL generates multiple output formats from a single input definition. This section describes each output type in detail.

## Output Summary

| Output | File Pattern | Description |
|--------|--------------|-------------|
| **VHDL Module** | `<module>_axion_reg.vhd` | AXI4-Lite slave entity |
| **C Header** | `<module>_regs.h` | Register macros and addresses |
| **Markdown** | `register_map.md` | Human-readable documentation |
| **HTML** | `<module>.html`, `index.html` | Styled web documentation |
| **XML** | `<module>_regs.xml` | IP-XACT compatible register map |
| **YAML** | `<module>_regs.yaml` | Re-importable YAML definition |
| **JSON** | `<module>_regs.json` | Machine-readable JSON format |

---

## VHDL Register Module

**File:** `<module>_axion_reg.vhd`

A fully compliant AXI4-Lite slave module with the following features:

### Entity Structure

```vhdl
entity spi_master_axion_reg is
    generic (
        BASE_ADDR : std_logic_vector(31 downto 0) := x"00000000"
    );
    port (
        -- AXI4-Lite Interface
        axi_aclk    : in  std_logic;
        axi_aresetn : in  std_logic;
        
        -- AXI Write Address Channel
        axi_awaddr  : in  std_logic_vector(31 downto 0);
        axi_awvalid : in  std_logic;
        axi_awready : out std_logic;
        
        -- AXI Write Data Channel
        axi_wdata   : in  std_logic_vector(31 downto 0);
        axi_wstrb   : in  std_logic_vector(3 downto 0);
        axi_wvalid  : in  std_logic;
        axi_wready  : out std_logic;
        
        -- AXI Write Response Channel
        axi_bresp   : out std_logic_vector(1 downto 0);
        axi_bvalid  : out std_logic;
        axi_bready  : in  std_logic;
        
        -- AXI Read Address Channel
        axi_araddr  : in  std_logic_vector(31 downto 0);
        axi_arvalid : in  std_logic;
        axi_arready : out std_logic;
        
        -- AXI Read Data Channel
        axi_rdata   : out std_logic_vector(31 downto 0);
        axi_rresp   : out std_logic_vector(1 downto 0);
        axi_rvalid  : out std_logic;
        axi_rready  : in  std_logic;
        
        -- Module Clock (for CDC, when enabled)
        module_clk  : in  std_logic;
        
        -- Register Signals
        control_reg : out std_logic_vector(31 downto 0);
        control_reg_wr_strobe : out std_logic;
        status_reg : in  std_logic_vector(31 downto 0);
        status_reg_rd_strobe : out std_logic;
        -- ... additional signals ...
    );
end entity;
```

### Features

| Feature | Description |
|---------|-------------|
| **Full AXI4-Lite Compliance** | Proper handshaking, response codes (OKAY, SLVERR) |
| **State Machine** | Handles independent address/data phases per AXI-LITE-005 |
| **Byte-Level Writes** | `wstrb` support for partial register updates |
| **Clock Domain Crossing** | Optional multi-stage synchronizers |
| **Access Control** | Proper RO/WO/RW behavior with error responses |
| **Strobe Generation** | Single-cycle read/write strobe outputs |
| **Default Values** | Register initialization on reset |
| **Address Decoding** | Automatic offset-based routing |

### Port Directions by Access Mode

| Access | Register Port | Direction | Strobe Ports |
|--------|---------------|-----------|--------------|
| `RO` | `signal_name` | `in` | `_rd_strobe : out` |
| `WO` | `signal_name` | `out` | `_wr_strobe : out` |
| `RW` | `signal_name` | `out` | `_rd_strobe`, `_wr_strobe : out` |

---

## C Header File

**File:** `<module>_regs.h`

A C header providing register definitions for embedded software development.

### Contents

```c
/**
 * @file spi_master_regs.h
 * @brief Register definitions for spi_master module
 * @note Generated by Axion HDL - Do not edit manually
 */

#ifndef SPI_MASTER_REGS_H
#define SPI_MASTER_REGS_H

#include <stdint.h>

/* Module Base Address */
#define SPI_MASTER_BASE_ADDR    0x00000000

/* Register Address Offsets (relative to base) */
#define SPI_MASTER_CONTROL_REG_OFFSET    0x00  /* SPI control */
#define SPI_MASTER_STATUS_REG_OFFSET     0x04  /* SPI status */
#define SPI_MASTER_TX_DATA_REG_OFFSET    0x08  /* Transmit data buffer */
#define SPI_MASTER_RX_DATA_REG_OFFSET    0x0C  /* Receive data buffer */

/* Absolute Register Addresses */
#define SPI_MASTER_CONTROL_REG_ADDR    0x00
#define SPI_MASTER_STATUS_REG_ADDR     0x04
#define SPI_MASTER_TX_DATA_REG_ADDR    0x08
#define SPI_MASTER_RX_DATA_REG_ADDR    0x0C

/* Bit Field Helper Macros */
#define GET_FIELD(val, mask, shift)    (((val) & (mask)) >> (shift))
#define SET_FIELD(val, mask, shift, new_val)    (((val) & ~(mask)) | (((new_val) << (shift)) & (mask)))

/* Read Macros */
#define SPI_MASTER_READ_CONTROL_REG()    \
    (*((volatile uint32_t*)(SPI_MASTER_BASE_ADDR + SPI_MASTER_CONTROL_REG_OFFSET)))
#define SPI_MASTER_READ_STATUS_REG()     \
    (*((volatile uint32_t*)(SPI_MASTER_BASE_ADDR + SPI_MASTER_STATUS_REG_OFFSET)))

/* Write Macros */
#define SPI_MASTER_WRITE_CONTROL_REG(val)    \
    (*((volatile uint32_t*)(SPI_MASTER_BASE_ADDR + SPI_MASTER_CONTROL_REG_OFFSET)) = (val))
#define SPI_MASTER_WRITE_TX_DATA_REG(val)    \
    (*((volatile uint32_t*)(SPI_MASTER_BASE_ADDR + SPI_MASTER_TX_DATA_REG_OFFSET)) = (val))

#endif /* SPI_MASTER_REGS_H */
```

### Macro Naming Convention

All macros use the pattern `<MODULE>_<REGISTER>_<SUFFIX>`:

| Suffix | Description | Example |
|--------|-------------|---------|
| `_OFFSET` | Offset from base address | `SPI_MASTER_STATUS_REG_OFFSET` |
| `_ADDR` | Absolute address | `SPI_MASTER_STATUS_REG_ADDR` |
| `READ_<REG>()` | Read accessor macro | `SPI_MASTER_READ_STATUS_REG()` |
| `WRITE_<REG>(val)` | Write accessor macro | `SPI_MASTER_WRITE_CONTROL_REG(val)` |

---

## Documentation Outputs

### Markdown (`register_map.md`)

Human-readable documentation with:

- Module overview (name, base address, CDC status)
- Register table with all fields
- Address mapping
- Descriptions

### HTML (`<module>.html`, `index.html`)

Styled web documentation featuring:

- Navigation index across all modules
- Sortable register tables
- Embedded CSS (no external dependencies)
- Responsive design
- Per-module detail pages

---

## Re-exportable Formats

These outputs can be used as inputs to Axion-HDL, enabling round-trip workflows.

### YAML Output (`<module>_regs.yaml`)

```yaml
module: spi_master
base_addr: '0x0000'
config:
  cdc_en: true
  cdc_stage: 2
registers:
- name: control_reg
  addr: '0x00'
  access: RW
  width: 32
  w_strobe: true
  description: 'SPI control: bit0=start, bits[15:8]=clk_div'
- name: status_reg
  addr: '0x04'
  access: RO
  width: 32
  r_strobe: true
  description: 'SPI status: bit0=busy, bit1=done, bit2=error'
```

### JSON Output (`<module>_regs.json`)

```json
{
  "module": "spi_master",
  "base_addr": "0x0000",
  "config": {
    "cdc_en": true,
    "cdc_stage": 2
  },
  "registers": [
    {
      "name": "control_reg",
      "addr": "0x00",
      "access": "RW",
      "width": 32,
      "w_strobe": true,
      "description": "SPI control: bit0=start, bits[15:8]=clk_div"
    }
  ]
}
```

### XML Output (`<module>_regs.xml`)

IP-XACT compatible format for EDA tool integration:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<register_map module="spi_master" base_addr="0x0000">
    <config cdc_en="true" cdc_stage="2"/>
    <register name="control_reg" addr="0x00" access="RW" width="32" 
              w_strobe="true" description="SPI control"/>
    <register name="status_reg" addr="0x04" access="RO" width="32" 
              r_strobe="true" description="SPI status"/>
</register_map>
```

---

## Generation Control

### CLI Flags

| Flag | Output | Default |
|------|--------|---------|
| `--vhdl` | VHDL register module | Enabled |
| `--c-header` | C header file | Disabled |
| `--md` | Markdown documentation | Disabled |
| `--html` | HTML documentation | Disabled |
| `--xml` | XML register map | Disabled |
| `--yaml` | YAML register map | Disabled |
| `--json` | JSON register map | Disabled |
| `--all` | All output formats | Disabled |

### Example Commands

```bash
# Generate only VHDL (default)
axion-hdl -s input.yaml -o output

# Generate VHDL and C headers
axion-hdl -s input.yaml -o output --vhdl --c-header

# Generate all formats
axion-hdl -s input.yaml -o output --all

# Generate documentation only
axion-hdl -s input.yaml -o output --md --html
```

---

## Output Directory Structure

After running `axion-hdl -s sources/ -o output/ --all`:

```
output/
├── index.html                    # Navigation page
├── register_map.md               # Combined Markdown docs
├── module1_axion_reg.vhd         # VHDL module
├── module1_regs.h                # C header
├── module1_regs.xml              # XML export
├── module1_regs.yaml             # YAML export
├── module1_regs.json             # JSON export
├── module1.html                  # HTML detail page
├── module2_axion_reg.vhd
├── module2_regs.h
├── module2_regs.xml
├── module2_regs.yaml
├── module2_regs.json
├── module2.html
└── ...
```

---

## Integration Examples

### Vivado IP Integrator

1. Generate VHDL output
2. Add `<module>_axion_reg.vhd` to your project
3. Instantiate in your top-level design
4. Connect AXI4-Lite interface to your bus

### Embedded C Development

1. Generate C header output
2. Include `<module>_regs.h` in your firmware
3. Use provided read/write macros
4. Optionally redefine `BASE_ADDR` for your memory map

### Documentation Workflow

1. Generate HTML/Markdown outputs
2. Publish to documentation server or include in project wiki
3. Re-export YAML/JSON for version control tracking
